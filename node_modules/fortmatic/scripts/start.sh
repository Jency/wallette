#!/usr/bin/env bash

export NODE_ENV=development
export WEBPACK_ENV=development
export BABEL_ENV=development

export LOCAL_X_PORT=3011
export LOCAL_AUTH_PORT=3014

set -e
while test $# -gt 0; do
  case "$1" in
    -ip | --ip)
      export X_URL=http://$(ipconfig getifaddr en0):$LOCAL_X_PORT
      export AUTH_URL=http://$(ipconfig getifaddr en0):$LOCAL_AUTH_PORT
      break
      ;;

    -dev | --dev | -development | --development)
      export X_URL=https://x2.dev.fortmatic.com
      export AUTH_URL=https://auth.dev.fortmatic.com
      break
      ;;

    -local | --local)
      export X_URL=http://localhost:$LOCAL_X_PORT
      export AUTH_URL=http://localhost:$LOCAL_AUTH_PORT
      break
      ;;
  esac
done

# Fallback
if [ -z "$X_URL" ]; then
  export X_URL=https://x2.fortmatic.com
  export AUTH_URL=https://auth.fortmatic.com
fi

echo
echo "Building Fortmatic SDK for development, pointing to:"
echo
echo "    x:     $X_URL"
echo "    auth:  $AUTH_URL"
echo

export TS_NODE_PROJECT="tsconfig.webpack.json"
webpack --progress --colors --watch --config webpack/webpack.config.ts
